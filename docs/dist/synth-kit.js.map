{"version":3,"file":"synth-kit.js","sources":["../lib/core.js","../lib/nodes.js","../lib/synths.js","../lib/drums.js"],"sourcesContent":["/* global AudioContext */\nconst isString = (o) => typeof o === \"string\"\nconst isFn = (o) => typeof o === \"function\"\nconst { exp, E } = Math\n\nlet ctx = null\n/**\n * Get an audio context.\n */\nexport function context (config, ac) {\n  if (ac) {\n    return ac\n  } else if (config && config.context) {\n    return config.context\n  } else {\n    if (ctx === null) ctx = new AudioContext()\n    return ctx\n  }\n}\n\nexport function ampToGain (amp) {\n  return (exp(amp) - 1) / (E - 1)\n}\n\n/**\n * Update a node property with a value. If the property is a parameter and\n * the value is a node, it will connect them\n */\nexport function plug (node, name, value) {\n  const target = node[name]\n  if (isFn(value)) value = value()\n  if (target === undefined || value === undefined || value === null) {\n    // ignore\n  } else if (target.value !== undefined) {\n    // it's a parameter\n    if (isFn(value.connect)) value.connect(target)\n    else target.setValueAtTime(value, 0)\n  } else if (target === undefined) {\n    // replace the old value with a new one\n    node[name] = value\n  }\n}\n\n/**\n * Update a node\n */\nexport function update (node, newState) {\n  const state = node.state || {}\n  Object.keys(newState).forEach(key => {\n    const newValue = newState[key]\n    const prevValue = state[key]\n    if (newValue !== prevValue) {\n      plug(node, key, newValue)\n      state[key] = newValue\n    }\n    node.state = state\n  })\n  return node\n}\n\nexport function triggerAttack (time, param, adsr) {\n  param.cancelScheduledValues(0)\n  // attack phase\n  const attack = adsr.attack || 0.01\n  param.setValueAtTime(0, time)\n  time += attack\n  param.linearRampToValueAtTime(1, time)\n\n  // decay-sustain phase\n  const sustain = adsr.sustain || 1\n  if (sustain !== 1) {\n    time += (adsr.decay || 0.01)\n    param.exponentialRampToValueAtTime(adsr.sustain, time)\n  }\n\n  // only trigger release if hold is defined\n  if (adsr.hold !== undefined) {\n    time += (adsr.hold || 0)\n    param.setValueAtTime(adsr.sustain)\n    time += (adsr.release || 0.1)\n    param.exponentialRampToValueAtTime(0.00001, time - 0.01)\n    param.setValueAtTime(0, time)\n  }\n}\n\nexport function polyphony (init, options = {}) {\n  const max = options.maxVoices || 16\n  const voices = []\n  for (var i = 0; i < max; i++) voices[i] = init()\n  let current = -1\n\n  return function next () {\n    current = (current + 1) % max\n    return voices[current]\n  }\n}\n\nexport function connected (object, connections) {\n  connections.reduce((src, next) => {\n    if (isString(src)) src = object[src]\n    if (isString(next)) next = object[next]\n    src.connect(next)\n    return next\n  })\n  return object\n}\n\nexport function connect (...nodes) {\n  nodes.reduce((prev, next) => {\n    prev.connect(next)\n    return next\n  })\n  return nodes\n}\n","import { update, triggerAttack } from \"./core\"\n\nfunction createNode (ac, name, initialState, state, params) {\n  const node = ac[\"create\" + name].apply(ac, params)\n  node.state = initialState\n  return state ? update(node, state) : node\n}\n\n/**\n * Create an Oscillator\n * A oscillator is always started\n */\nexport function Osc (ac, state) {\n  const osc = createNode(ac, \"Oscillator\", Osc.state, state)\n  if (state.start !== false) osc.start(state.start || 0)\n  return osc\n}\nOsc.state = {\n  type: \"sine\",\n  frequency: 440,\n  detune: 0\n}\n\nexport function Filter (ac, state) {\n  return createNode(ac, \"BiquadFilter\", Filter.state, state)\n}\nFilter.state = {\n  type: \"lowpass\",\n  frequency: 350,\n  detune: 0,\n  Q: 1,\n}\n\n/**\n * Create a Gain node. By default a it's gain value it's 0\n */\nexport const Gain = (ac, state) => {\n  const gain = createNode(ac, \"Gain\", Osc.state, state)\n  if (gain.state.gain === 0) gain.gain.setValueAtTime(0, 0)\n  return gain\n}\nGain.state = {\n  gain: 0\n}\n\nexport function GainEnvelope (ac, state) {\n  const env = Gain(null, ac)\n  env.state = state\n  env.trigger = function (time, dur) {\n    triggerAttack(time, env.gain, env.state)\n  }\n  return env\n}\nGainEnvelope.state = {\n  attack: 0.01,\n  release: 0.2\n}\n\nexport function FilterEnvelope (ac, state) {\n}\n","import { connected, update, plug } from \"./core\"\nimport { Osc, Filter, Gain, GainEnvelope, FilterEnvelope } from \"./nodes\"\n\n/**\n * Low Frequency Oscillator\n */\nexport function LFO (ac, state) {\n  const lfo = Osc(ac)\n  lfo.amp = Gain(ac)\n  lfo.rate = lfo.osc.frequency\n  lfo.amount = lfo.amp.gain\n  lfo.update = (state) => update(lfo, state)\n  return update(lfo, LFO.state)\n}\nLFO.state = {\n  // the lfo frequency\n  rate: 3,\n  // the lfo intensity\n  amount: 0.5\n}\n\n/**\n * Voltage Controlled Oscillator\n */\nexport function VCO (ac, state) {\n  state = Object.assign({}, VCO.state, state)\n  const vco = Osc(ac, state)\n  vco.modulator = LFO(ac, state.modulator)\n  plug(vco, \"frequency\", vco.modulator)\n  vco.start()\n  vco.modulator.start()\n  return vco\n}\nVCO.state = {\n  type: \"sawtooth\",\n  frequency: 440,\n  detune: 0,\n  modulator: {\n    rate: 2,\n    amount: 0.2,\n  }\n}\n\nexport function VCF (ac, state) {\n  const filter = Filter(ac, state)\n  filter.envelope = FilterEnvelope(state)\n  filter.trigger = filter.envelope.trigger\n  return filter\n}\n\n/**\n * Voltage controlled amplified\n */\nexport function VCA (ac, state, envState) {\n  if (envState) envState = state\n  const vca = Gain(ac, state)\n  vca.envelope = GainEnvelope(ac, envState)\n  vca.trigger = vca.envelope.trigger\n}\n\nexport function MonoSynth (ac, state) {\n  if (!state) state = MonoSynth.defaults\n  else state = Object.assign({}, MonoSynth.defaults, state)\n\n  const synth = connected({\n    oscillator: VCO(ac, state.oscillator),\n    filter: VCF(ac, state.filter),\n    amp: VCA(ac, state, state.envelope),\n  }, [\"oscillator\", \"filter\", \"envelope\", \"amp\"])\n  synth.state = state\n\n  return synth\n}\nMonoSynth.defaults = {\n  oscillator: {\n    type: \"sawtooth\"\n  },\n  envelope: {\n    attack: 0.01,\n    decay: 0.1,\n    sustain: 0.8,\n    release: 0.3,\n  },\n  gain: 0.5\n}\n","\nexport function Kick (ac, state) {\n\n}\n"],"names":["isString","o","isFn","exp","Math","E","ctx","context","config","ac","AudioContext","ampToGain","amp","plug","node","name","value","target","undefined","connect","setValueAtTime","update","newState","state","keys","forEach","newValue","key","prevValue","triggerAttack","time","param","adsr","cancelScheduledValues","attack","linearRampToValueAtTime","sustain","decay","exponentialRampToValueAtTime","hold","release","polyphony","init","options","max","maxVoices","voices","i","current","next","connected","object","connections","reduce","src","nodes","prev","createNode","initialState","params","apply","Osc","osc","start","Filter","Gain","gain","GainEnvelope","env","trigger","dur","FilterEnvelope","LFO","lfo","rate","frequency","amount","VCO","Object","assign","vco","modulator","VCF","filter","envelope","VCA","envState","vca","MonoSynth","defaults","synth","oscillator","Kick"],"mappings":"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"}