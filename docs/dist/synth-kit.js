!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.SynthKit=e.SynthKit||{})}(this,function(e){"use strict";function t(e,t){var n={},a=Object.keys(t);return a.forEach(function(a){var r=t[a][0];n[a]="function"==typeof r?r(e):r}),a.forEach(function(e){var a=t[e][1],r=n[e];"output"===a?i(n,r):u(r,n[a])}),n.update=function(t,r){return r=r||e.currentTime,t&&a.forEach(function(e){n[e].update(t[e],r)}),n},n.inspect=function(){return a.reduce(function(e,t){return e[t]=n[t].inspect(),e},{})},n}function n(e,t,n,u){var i=e["create"+t](u);return i.update=function(e){return e&&n.forEach(function(t){r(i,t,e[t])}),i},i.inspect=function(){return n.reduce(function(e,t){return e[t]=a(i,t),e},{})},i}function a(e,t){var n=e[t];return n&&void 0!==n.value?n.value:n}function r(e,t,n){var a=e[t];K(n)&&(n=n()),void 0===n||void 0===a||(void 0!==a.value?K(n.connect)?n.connect(a):(a.value=n,a.setValueAtTime(n,0)):e[t]=n)}function u(e,t){t&&e.connect(t)}function i(e,t){e.connect=function(n){return n===!0&&(n=t.context.destination),t.connect(n),e}}function o(e,t){return e?Object.assign({},t,e):t}function c(e,t,n){t.cancelScheduledValues(0);var a=n.attack||.01,r=n.peak||1;t.setValueAtTime(0,e),e+=a,console.log("attack",a,r,e),t.linearRampToValueAtTime(r,e);var u=n.decay||.01,i=n.sustain||0;e+=u,t.linearRampToValueAtTime(i,e);var o=n.hold||0;o&&(e+=o,t.setValueAtTime(i,e));var c=function(e){if(i){t.setValueAtTime(e,i);var a=n.release||0;console.log("Trigger release",a,e),e+=a,t.exponentialRampToValueAtTime(1e-5,e)}};return o&&c(e),c}function s(e,t){return n(e,"Gain",s.params).update(t)}function p(e,t){var n=s(e,H);return t=Object.assign({},p.defaultState,t),n.update=function(e){return t=Object.assign(t,e),n},n.inspect=function(){return t},n.trigger=function(a,r){a||(a=e.currentTime);var u=c(a,n.gain,t);return r&&u(a+r),u},n}function l(e,t,n){for(var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=e.createBuffer(1,t,e.sampleRate),u=r.getChannelData(0),i=0;i<t;i++)u[i]=n(a?t-i:i);return r}function f(e,t,a){var r=n(e,"BufferSource",f.params);return r.update(a),r.buffer=t,r}function v(e,t){t=Object.assign({},v.defaults,t);var n=t.duration*e.sampleRate,a=l(e,n,function(){return 2*Math.random()-1}),r=f(e,a,{loop:!0});return r.start(),r}function d(e,t,n){var a=s(e);return a.trigger=function(r,u){r||(r=e.currentTime);var i=f(e,t,n);i.connect(a),i.onended=function(){a.onended&&a.onended(),i.disconnect()},i.start(r)},a}function g(e,t){return t=Object.assign({},g.defaults,t),d(e,l(e,t.duration*e.sampleRate,function(){return 2*Math.random()-1}))}function m(e,t){return s(e,t)}function y(e,t){var a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=n(e,"Oscillator",y.params);return a&&r.start(+a),r}function b(e,t){return y(e,t)}function h(e,t){var a=n(e,"BiquadFilter",h.params);return a.attack=.01,a.decay=.1,a.octaves=2,a.trigger=function(t,n){t||(t=e.currentTime),this.base=this.frequency.value,this.peak=this.base*this.octaves;var r=c(t,a.frequency,a);return n&&r(t+n),r},a.update(t)}function k(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"none",a=e.createWaveShaper();return a.curve=t,a.oversample=n,a}function q(e,t){var a=n(e,"Gain",q.params);a.drive=a.gain,_||(_=T());var r=k(e,_,"2x");return a.connect(r),a.connect=r.connect.bind(r),a.update(t)}function T(){for(var e=65536,t=new Float32Array(e),n=0;n<e;n++){var a=(n-e/2)/(e/2);t[n]=Math.tanh(a)}return t}function E(e,n){n=Object.assign({},E.defaults,n);var a=t(e,{oscillator:[y,"envelope"],click:[g,"envelope"],envelope:[p,"vcf"],vcf:[h,"clipper"],clipper:[q,"amp"],amp:[s,"output"]}).update(n);return a.trigger=function(e){a.click.trigger(e),a.envelope.trigger(e)},a}function O(e,n){n=Object.assign({},O.defaults,n);var a=t(e,{osc1:[y,"oscEnv"],osc2:[y,"oscEnv"],oscEnv:[p,"amp"],noise:[v,"noiseEnv"],noiseEnv:[p,"amp"],amp:[s,"output"]}).update(n);return a.trigger=function(e){a.oscEnv.trigger(e),a.noiseEnv.trigger(e)},a}function j(e,t,n){if(!t)throw Error("OscBank requires an array 'ratios' in constructor");var a=Object.assign({},j.defaults,n);V(a,t);var r=s(e),u=t.map(function(t){return N(s(e),r)}),i=u.map(function(t,n){var r=N(y(e),t);return r.type=a.types[n],r}),o={output:r,amps:u,oscs:i};return o.connect=function(e){return N(r,e)},o.update=function(t,n){return"number"==typeof t||"string"==typeof t?(a.frequency=+t,A(o,a,n)):t&&(n=n||e.currentTime,t.gains&&(S(a.gains,t.gains),F(o,a,n)),void 0!==t.frequency&&(a.frequency=t.frequency,A(o,a,n))),o},o.inspect=function(){return a},o.update(a)}function V(e,t){var n=e.gains,a=e.types;e.gains=t.map(function(e,t){return n[t%n.length]}),e.types=t.map(function(e,t){return a[t%a.length]}),e.ratios=t}function A(e,t,n){var a=e.oscs,r=t.ratios,u=t.frequency;console.log("UPDATE FREQS",r,u),a.forEach(function(e,t){e.frequency.setValueAtTime(r[t]*u,n)})}function F(e,t,n){var a=e.amps,r=t.gains;a.forEach(function(e,t){void 0!==r[t]&&e.gain.setValueAtTime(r[t],n)})}function S(e,t){if(t)for(var n=e.length,a=0;a<n;a++)void 0!==t[a]&&(e[a]=t[a])}function w(e,t){return n(e,"BiquadFilter",w.params).update(t)}function x(e,n){n=Object.assign({},x.defaults,n);var a=t(e,{bank:[j(e,U,n.bank),"midFilter"],midFilter:[w,"envelope"],envelope:[p,"hiFilter"],hiFilter:[w,"amp"],amp:[s,"output"]}).update(n);return a.trigger=a.envelope.trigger,console.log(a),a}function R(e,n){n=n?Object.assign({},R.defaultState,n):R.defaultState;var a=t(e,{osc1:[y,"env1"],env1:[p,"filter"],osc2:[y,"env2"],env2:[p,"filter"],filter:[w,"amp"],amp:[s,"output"]}).update(n);return a.trigger=function(e){a.env1.trigger(e),a.env2.trigger(e)},a}function B(e,n){var a=o(n,B.defaults),r=t(e,{oscillator:[y,"envelope"],envelope:[p,"amp"],pulse:[g,"amp"],amp:[s,"output"]}).update(a);return r.trigger=r.envelope.trigger,r}function C(e,n){var a=o(n,C.defaults),r=t(e,{oscillator:[y,"envelope"],envelope:[p,"amp"],pulse:[g,"amp"],amp:[s,"output"]}).update(a);return r.trigger=function(e){r.pulse.trigger(e),r.envelope.trigger(e)},r}function M(e,n){n=Object.assign({},M.defaults,n);var a=t(e,{oscillator:[b,"vcf"],vcf:[h,"envelope"],envelope:[p,"amp"],amp:[m,"output"]}).update(n);return a.trigger=function(t,n,r){n=n||e.currentTime,t&&(a.oscillator.frequency.setValueAtTime(t,n),a.vcf.frequency.setValueAtTime(t/2,n)),a.vcf.trigger(n,r),a.envelope.trigger(n,r)},a}function D(e,t){t=Object.assign({},D.defaults,t);var a=s(e,t),r=n(e,"Delay",D.params,t.maxDelay);return r.resonance=a.gain,r.connect(a),a.connect(r),r.update(t)}function P(e,n){var a=t(e,{noise:[v,"envelope"],envelope:[p,"combFilter"],combFilter:[D,"amp"],amp:[s,"output"]}).update(n);return a.trigger=function(e,t,n){var r=1/e;a.combFilter.delayTime.setValueAtTime(r,t),a.envelope.trigger(t)},a}function Q(e){if(e){return{bank:{gains:(e.replace(/[^012345678]/g,"")+"000000000").slice(0,9).split("").map(function(e){return Math.abs(+e/8)})}}}}function G(e,n){n=n?Q(n):z.smith;var a=Object.assign({},G.defaults,n),r=t(e,{bank:[j(e,W),"envelope"],envelope:[p,"amp"],click:[g,"output"],amp:[s,"output"]}).update(a);return r.setPreset=function(e,t){var n=z[e]||Q(e);r.update(n)},r.trigger=function(e,t,n){return r.bank.update(e,t),r.envelope.trigger(t,n),r},r}var K=function(e){return"function"==typeof e};s.params=["gain"];var H={gain:0};p.params=["base","peak","attack","decay","sustain","release"],p.defaultState={peak:1,attack:.01,decay:.2},f.params=["detune","loop","loopStart","loopEnd","playbackRate"],v.defaults={duration:1,loop:!0},d.state={gain:.8},g.defaults={duration:.001},y.params=["type","frequency","detune"],h.params=["type","frequency","detune","Q","attack","decay","octaves"],h.defaults={type:"lowpass",frequency:880,attack:.1,decay:.5,octaves:2};var _=null;q.params=["drive"],E.defaults={oscillator:{type:"sine",frequency:48},envelope:{attack:.1,decay:.2},vcf:{type:"lowpass",frequency:48,envelope:{base:48,peak:100,attack:.001,decay:.6}},amp:{gain:1}},O.defaults={osc1:{type:"sine",frequency:238},osc2:{type:"sine",frequency:476},oscEnv:{peak:.4,attack:.01,decay:.1},noise:{type:"white"},noiseEnv:{attack:.01,decay:.08},amp:{gain:.5}};var N=function(e,t){return e.connect(t),e};j.defaults={frequency:440,gains:[0],types:["sine"],compensate:!0},w.params=["type","frequency","detune","Q"];var U=[263,400,421,474,587,845].map(function(e){return e/400});x.defaults={bank:{frequency:400,types:["square"],gains:[.5],compensate:!1},midFilter:{type:"bandpass",frequency:1e4},envelope:{attack:.01,decay:.1},hiFilter:{type:"highpass",frequency:8e3},amp:{gain:.8}},R.defaultState={osc1:{type:"triangle",frequency:587},env1:{gain:.6,attack:.01,decay:.05,sustain:0},osc2:{type:"triangle",frequency:845},env2:{gain:.8,attack:.1,decay:.1},filter:{type:"bandpass",frequency:2640,Q:3.5},amp:{gain:.2}},B.defaults={oscillator:{frequency:310},pulse:{gain:.8},envelope:{decay:.31},amp:{gain:.4}},C.defaults={oscillator:{frequency:165},pulse:{gain:.1},envelope:{decay:.31},amp:{gain:1}},M.defaults={oscillator:{type:"sawtooth"},vcf:{type:"lowpass",Q:2,attack:.1,octaves:2,decay:1},envelope:{attack:.1,decay:.5,sustain:.8,release:2},amp:{gain:.5}},D.params=["delayTime","resonance"],D.defaults={maxDelay:1,delayTime:.1,resonance:.5},P.defaults={noise:{type:"white"},envelope:{attack:.1,decay:.1},combFilter:{delayTime:.2,resonance:.9}};var W=[.5,1.49882353,1,2,2.99764706,4,5.040941178,5.99529412,8],z={gospel:Q("88 8000 008"),blues:Q("88 8800 000"),bluesB:Q("88 5324 588"),booker:Q("88 8630 000"),onions:Q("80 8800 008"),smith:Q("88 8000 000"),mcgriff:Q("86 8600 006"),errol:Q("80 0008 888"),genesis:Q("33 6866 330")};G.defaults={bank:{types:["sine"]},amp:{gain:.8}},e.Gain=s,e.GainEnvelope=p,e.Noise=v,e.Sample=d,e.Pulse=g,e.VCA=m,e.VCO=b,e.VCF=h,e.Kick=E,e.Snare=O,e.HiHat=x,e.Cowbell=R,e.Conga=B,e.Tom=C,e.MonoSynth=M,e.Pluck=P,e.Tonewheel=G,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=synth-kit.js.map
