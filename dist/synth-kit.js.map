{"version":3,"file":"synth-kit.js","sources":["../lib/core.js","../lib/nodes.js","../lib/synths.js","../lib/drums.js"],"sourcesContent":["const isString = (o) => typeof o === \"string\"\nconst isFn = (o) => typeof o === \"function\"\nconst { exp, E } = Math\n\nexport function ampToGain (amp) {\n  return (exp(amp) - 1) / (E - 1)\n}\n\n/**\n * Update a node property with a value. If the property is a parameter and\n * the value is a node, it will connect them\n */\nexport function plug (node, name, value) {\n  const target = node[name]\n  if (isFn(value)) value = value()\n  if (target === undefined || value === undefined || value === null) {\n    // ignore\n  } else if (target.value !== undefined) {\n    // it's a parameter\n    if (isFn(value.connect)) {\n      value.connect(target)\n    } else {\n      target.setValueAtTime(value, 0)\n    }\n  } else if (target === undefined) {\n    // replace the old value with a new one\n    node[name] = value\n  }\n}\n\n/**\n * Update a node\n */\nexport function update (node, newState) {\n  const state = node.state || {}\n  Object.keys(newState).forEach(key => {\n    const newValue = newState[key]\n    const prevValue = state[key]\n    if (newValue !== prevValue) {\n      plug(node, key, newValue)\n      state[key] = newValue\n    }\n    node.state = state\n  })\n  return node\n}\n\nexport function polyphony (init, options = {}) {\n  const max = options.maxVoices || 16\n  const voices = []\n  for (var i = 0; i < max; i++) voices[i] = init()\n  let current = -1\n\n  return function next () {\n    current = (current + 1) % max\n    return voices[current]\n  }\n}\n\nexport function connected (object, connections) {\n  connections.reduce((src, next) => {\n    if (isString(src)) src = object[src]\n    if (isString(next)) next = object[next]\n    src.connect(next)\n    return next\n  })\n  return object\n}\n\nexport function connect (...nodes) {\n  nodes.reduce((prev, next) => {\n    prev.connect(next)\n    return next\n  })\n  return nodes\n}\n\n/**\n * Create a connect function with for the given node\n * The return function have two special characteristics:\n * - It's chainable\n * - It accepts `true` as param to connect to node's AudioContext's destination\n */\nexport function connectWith (node, parent) {\n  if (!parent) throw Error(\"no parent!\")\n  const conn = node.connect\n  return function (dest) {\n    if (dest === true) conn.call(node, node.context.destination)\n    else conn.apply(node, arguments)\n    return parent\n  }\n}\n","import { update } from \"./core\"\nconst assign = Object.assign\n\nfunction createNode (ac, name, initialState, state, params) {\n  const node = ac[\"create\" + name].apply(ac, params)\n  node.state = assign({}, initialState)\n  return state ? update(node, state) : node\n}\n\n/**\n * Create an Oscillator\n * A oscillator is always started\n */\nexport function Osc (ac, state) {\n  const osc = createNode(ac, \"Oscillator\", Osc.state, state)\n  const start = state ? state.start : 0\n  if (start !== false) osc.start(start || 0)\n  return osc\n}\nOsc.state = {\n  type: \"sine\",\n  frequency: 440,\n  detune: 0\n}\n\nexport function Filter (ac, state) {\n  return createNode(ac, \"BiquadFilter\", Filter.state, state)\n}\nFilter.state = {\n  type: \"lowpass\",\n  frequency: 350,\n  detune: 0,\n  Q: 1,\n}\n\n/**\n * Create a Gain node. By default a it's gain value it's 0\n */\nexport const Gain = (ac, state) => {\n  const gain = createNode(ac, \"Gain\", Gain.state, state)\n  if (gain.state.gain === 0) gain.gain.setValueAtTime(0, 0)\n  return gain\n}\nGain.state = {\n  gain: 0\n}\n\nexport function GainEnvelope (ac, state) {\n  const env = Gain(ac)\n  env.state = assign({}, GainEnvelope.state, state)\n  env.gain.value = 0.5\n  env.trigger = function (time, dur) {\n    triggerAttack(time || 0, env.gain, env.state)\n  }\n  return env\n}\nGainEnvelope.state = {\n  attack: 0.01,\n  release: 0.2\n}\n\nexport function FilterEnvelope (ac, state) {\n}\n\n// ## Private utility functions\n\nfunction triggerAttack (time, param, adsr) {\n  param.cancelScheduledValues(0)\n  // attack phase\n  const attack = adsr.attack || 0.01\n  param.setValueAtTime(0, time)\n  time += attack\n  param.linearRampToValueAtTime(1, time)\n\n  // decay-sustain phase\n  const sustain = adsr.sustain || 1\n  if (sustain !== 1) {\n    time += (adsr.decay || 0.01)\n    param.exponentialRampToValueAtTime(sustain, time)\n  }\n\n  // only trigger release if hold is defined\n  if (adsr.hold !== undefined) {\n    time += (adsr.hold || 0)\n    param.setValueAtTime(sustain, time)\n    time += (adsr.release || 0.1)\n    param.exponentialRampToValueAtTime(0.00001, time - 0.01)\n  }\n}\n","import { connectWith, connect, update, plug } from \"./core\"\nimport { Osc, Filter, Gain, GainEnvelope, FilterEnvelope } from \"./nodes\"\n\n/**\n * Low Frequency Oscillator\n */\nexport function LFO (ac, state) {\n  const lfo = Osc(ac)\n  lfo.amp = Gain(ac)\n  lfo.rate = lfo.frequency\n  lfo.amount = lfo.amp.gain\n  lfo.update = (state) => update(lfo, state)\n  lfo.connect(lfo.amp)\n  lfo.connect = connectWith(lfo.amp, lfo)\n  update(lfo, LFO.state)\n  console.log(\"JODER\", lfo.frequency.value, lfo.amp.gain.value)\n}\nLFO.state = {\n  type: \"sine\",\n  // the lfo frequency\n  rate: 3,\n  // the lfo intensity\n  amount: 0.5\n}\n\n/**\n * Voltage Controlled Oscillator\n */\nexport function VCO (ac, state) {\n  state = Object.assign({}, VCO.state, state)\n  const vco = Osc(ac, state)\n  vco.modulator = LFO(ac, state.modulator)\n  plug(vco, \"detune\", vco.modulator)\n  vco.connect = connectWith(vco, vco)\n  return vco\n}\nVCO.state = {\n  type: \"sawtooth\",\n  frequency: 440,\n  detune: 0,\n  modulator: {\n    rate: 5,\n    amount: 1,\n  }\n}\n\nexport function VCF (ac, state, envState) {\n  if (!envState) envState = state\n  const filter = Filter(ac, state)\n  // filter.envelope = FilterEnvelope(state)\n  // filter.trigger = filter.envelope.trigger\n  filter.trigger = () => {\n    // TODO\n  }\n  console.log(\"FILTER\", filter, filter.state)\n  return filter\n}\n\n/**\n * Voltage controlled amplified\n */\nexport function VCA (ac, state, envState) {\n  if (!envState) envState = state\n  const vca = Gain(ac, state)\n  vca.envelope = GainEnvelope(ac, envState)\n  vca.connect(vca.envelope)\n  // add connect function\n  vca.connect = connectWith(vca.envelope, vca)\n  // add trigger function\n  vca.trigger = vca.envelope.trigger\n  return vca\n}\n\nexport function MonoSynth (ac, state) {\n  if (!state) state = MonoSynth.defaults\n  else state = Object.assign({}, MonoSynth.defaults, state)\n\n  // Create the synth\n  const synth = {\n    state,\n    oscillator: VCO(ac, state.oscillator),\n    filter: VCF(ac, state.filter),\n    amp: VCA(ac, state, state.envelope),\n  }\n  connect(synth.oscillator, synth.filter, synth.amp)\n\n  // Synth API\n  synth.connect = connectWith(synth.amp, synth)\n  synth.trigger = (freq, time, dur) => {\n    time = time || ac.currentTime\n    if (freq) synth.oscillator.frequency.setValueAtTime(freq, time)\n    synth.amp.trigger(time, dur)\n  }\n  return synth\n}\nMonoSynth.defaults = {\n  oscillator: {\n    type: \"sawtooth\"\n  },\n  filter: {\n    type: \"lowpass\",\n    frequency: 4000,\n  },\n  envelope: {\n    attack: 0.01,\n    decay: 0.1,\n    sustain: 0.8,\n    release: 0.3,\n  },\n  gain: 0.5\n}\n","\nexport function Kick (ac, state) {\n\n}\n"],"names":["isString","o","isFn","exp","Math","E","ampToGain","amp","plug","node","name","value","target","undefined","connect","setValueAtTime","update","newState","state","keys","forEach","newValue","key","prevValue","polyphony","init","options","max","maxVoices","voices","i","current","next","connected","object","connections","reduce","src","nodes","prev","connectWith","parent","Error","conn","dest","call","context","destination","apply","arguments","assign","Object","createNode","ac","initialState","params","Osc","osc","start","Filter","Gain","gain","GainEnvelope","env","trigger","time","dur","FilterEnvelope","triggerAttack","param","adsr","cancelScheduledValues","attack","linearRampToValueAtTime","sustain","decay","exponentialRampToValueAtTime","hold","release","LFO","lfo","rate","frequency","amount","log","VCO","vco","modulator","VCF","envState","filter","VCA","vca","envelope","MonoSynth","defaults","synth","oscillator","freq","currentTime","Kick"],"mappings":"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"}